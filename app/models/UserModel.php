<? 

class UserModel{
	protected $connect;
	public function __construct(){
		$this->connect = new mysqli(DB_HOST , DB_USER , DB_PASSWORD ,DB_NAME);
		$this->connect->set_charset("utf8"); 
		if(!$this->connect) die('no connect database');

	}	


	public function checkUser($login , $password){
		$query = $this->connect->query("SELECT user_id , user_password FROM users WHERE user_login='".$this->connect->real_escape_string($login)."'");
		$data = $query->fetch_assoc();	
	
		if($data['user_password'] === md5($password)){

			$hash = md5($this->generateCode(10));

			$query2 = $this->connect->query("UPDATE users  SET user_hash='".$hash."' WHERE user_id='".$data['user_id']."'");

			 setcookie("id", $data['user_id'], time()+60*60*24*30 , '/');
        	 setcookie("hash", $hash, time()+60*60*24*30 , '/');

        	 return true;
		}else{
			return false;
		}




	}

	public function checkAuth(){
		if (isset($_COOKIE['id']) and isset($_COOKIE['hash'])){
			$query = $this->connect->query("SELECT * FROM users WHERE user_hash='".$_COOKIE['hash']."'");

			$check = $query->fetch_assoc();

			if($check){
				return true;
			}else{
				return false;
			}
		}
	}
		# Функция для генерации случайной строки

	protected function generateCode($length=6) {

	    $chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHI JKLMNOPRQSTUVWXYZ0123456789";

	    $code = "";

	    $clen = strlen($chars) - 1;  
	    while (strlen($code) < $length) {

	            $code .= $chars[mt_rand(0,$clen)];  
	    }

	    return $code;

	}
}



















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































